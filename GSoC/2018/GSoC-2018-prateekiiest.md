# Organization:  SunPy in OpenAstronomy

### Project: Transition to Astropy Time
##### Mentors: @Cadair,  @Nabobalis, @Punyaslok
## CURRENTLY UPDATED VERSION IS IN DOCS. WILL UPDATE THIS

#### Student Information


* **Name**: Prateek Chanda
* **Time Zone** : +05:30 GMT
* **IRC Handle** : prateekiiest
* **Github ID**: [prateekiiest](https://github.com/prateekiiest)
* **Blog**  - [Prateek Chanda @Medium](medium.com/@prateekkol21)
* **LinkedIn** : [My LinkedIn Profile](https://www.linkedin.com/in/prateek-chanda-iiest/)
* **Website** : [CodeFolio](https://prateekiiest.github.io)
*  **Mail** :  prateekkol21@gmail.com or  prateek.dd2015@cs.iiests.ac.in
--------------

#### University Information



*     University: Indian Institute of Engineering Science and Technology, Shibpur
*        Major: Computer Science and Engineering
*        Current Academic Year : Third Year
*       Graduate Year: 2019

---------

#### Experience In Programming


* I have been involved in open source for the past 2 years and been contributing to different open source projects including Algorithms based and Python based Desktop Applications.
*  Intermediate knowledge of Python for Data Science and Statistical Analysis.
*   I have contributed to some projects on Algorithms. Hence I am comfortable in working with Git and using GitHub.
*   An active coder on [HackerRank](https://www.hackerrank.com/prateekkol2103) and [HackerEarth](https://www.hackerearth.com/@prateekkol21/).
*   I am comfortable in doing programs in Python. I did two major projects on Machine Learning in Python which majorly  uses statistical analysis (pandas, numpy) and the use of Jupyter Notebook. These were  project works for Udacity Machine Learning Nanodegree:
 -  [Titanic Survival Exploration](https://github.com/prateekiiest/titanic_survival_exploration)
 -  [Boston Housing](https://github.com/prateekiiest/boston_housing)
* I worked recently on one of my personal projects based in python which saw many active participation from different communities. The project being called [Code Sleep Python](https://github.com/prateekiiest/Code-Sleep-Python). It is a project
based in python for building desktop applications and games in python.
* I did one research internship previous year on machine learning at CNERG research Lab, IIT Kharagpur where I worked on a data mining project using Python.


#### Hackathons and Open Source experience

* Go-Hack Idea 2016:  I participated in Go-Hack Idea in 2016 where I proposed an idea on smart home security systems along with some small implementations using Adruino, Raspberry Pi.
* Contributing to Organizations like FOSSASIA and other small organisations: I had been contributing to some open source organizations and repositories for the past two years.
I  have currently total 163 Pull Requests done so far and 72 issues being worked so far.
* Currently I have around 93 repository projects and among them 75 repositories (some big and some small projects) are the ones that I have contributed to. All my contributions can be seen on my [github profile](https://github.com/prateekiiest).
* Mentored students under different Open Source events like Hacktoberfest , Kharagpur Winter of Code and 24 Pull Requests on some of my own personal projects primarily written in Python.
* Got the opportunity to speak at different Open Source Summits. Got invited to different developer conferences like RISE Hong Kong 2017, FOSSASIA Open Tech , Google Developers Solve for India among others.
* Currently I am the GitHub Campus Expert of my college and along with direct support from GitHub I am helping to grow my community in campus, involving more people in Open Source and coding.


---------------


#### Interest In OpenAstronomy

OpenAstronomy consisting of 8 sub-organisations is a collaboration between open source astronomy and astrophysics projects that are being used by researchers around the world to study our universe. The analysis of data obtained from observatories like SDO , Hubble Space Telescope helps multiple types of research from being able to forecast a solar storm to detect planets in other stars.

**Astronomy is at the frontier of science.** There are new discoveries made all the time.

I had always a love for the sky and a kind of childhood fascination in the field astronomy and to me its feels amazing to see real time data of the Sun , captured just a few hours back, in my computer screen and I am able to analyse those data obtained.
The organisation is inspiring new developers like me to join the open source community and build the project code base together with lead developers and that is where I find the joy of Open Source.
It has been really a great experience contributing to Sunpy since I joined the Sunpy community.

I did not qualify for my first GSOC with Open Astronomy back in 2017. But I did not give up. I loved the project and wanted to contribute as much as I can. Having been worked with the SunPy project for the past 1 year, I learnt many new things in open source, team management, writing long lines of code and lastly the joy of your contribution being accepted.

OpenAstronomy along with Google Summer of Code will give me this opportunity to be a part of these huge project work on Solar Data Analysis and I feel it as a privilege to contribute to such an open-source software in the field of astronomy.


###  Contribution to Sunpy

I have been involved with the SunPy project for the past 1 year contributing since December 2016. And I am delighted to be a part of consecutive 7 version releases of SunPy and am grateful to being
acknowledged for my work.

| Pull Requests |  Corresponding Issue | Status |
|:-------------:|:-------------:|:-------------:|
|[More Mapcubes Examples - Gallery Examples #2455](https://github.com/sunpy/sunpy/pull/2455)| [More examples in the gallery on simple map and mapcube manipulation #2413](https://github.com/sunpy/sunpy/issues/2413) | Open |
| [ImageAnimatorWCS Update #2306](https://github.com/sunpy/sunpy/pull/2306)|[Ticklabel Control for ImageAnimatorWCS #2288](https://github.com/sunpy/sunpy/issues/2288) | Open |
|[Remove Gamma usage in Map #2424](https://github.com/sunpy/sunpy/pull/2424)|[Gamma in map doesn't do anything #2333](https://github.com/sunpy/sunpy/issues/2333)|Merged|
|[Finding Local Peaks in Solar Data - Gallery Update #2339](https://github.com/sunpy/sunpy/pull/2339 )| Suggested this example| Merged|
|[Masking Hot Pixels](https://github.com/sunpy/sunpy/pull/2325)| Found Bug in Example| Merged|
|[Brightest pixel location may occur at multiple position](https://github.com/sunpy/sunpy/pull/2319)|Found similar bug in Example| Merged |
|[Brightest pixel location redundancy removed](https://github.com/sunpy/sunpy/pull/2318)|Removed Redundancy in Examples | Merged|
|[differential_rotation.py rot_hpc to use sunpy.coordinates](https://github.com/sunpy/sunpy/pull/2107)|Enhancement from my side| Closed|
|[Added documentation for suds-py3 incompatibility](https://github.com/sunpy/sunpy/pull/2073)| [VSOClient.query returns no result in Python 3.5](https://github.com/sunpy/sunpy/issues/1912)|Merged|
|[Create north_offset_frame.py Gallery Example Added](https://github.com/sunpy/sunpy/pull/2066)|Gallery Example| Closed|
|[Update README.md Matrix Org linked](https://github.com/sunpy/sunpy/pull/2059)|Enhancement | Merged |
|[Update README.md](https://github.com/sunpy/sunpy/pull/2054)|[README badges broken](https://github.com/sunpy/sunpy/issues/2053)|Merged|
|[suds-py3 does not work with VSO added documentation](https://github.com/sunpy/sunpy/pull/2052)|[VSOClient.query returns no result in Python 3.5](https://github.com/sunpy/sunpy/issues/1912)|Closed|
|[Added documentation for database/tests](https://github.com/sunpy/sunpy/pull/2049)|[database tests depend on data/tests dir](https://github.com/sunpy/sunpy/issues/732)|Merged|
|[Update vso.py](https://github.com/sunpy/sunpy/pull/2042)|Enhancement Documentation |Merged|
|[Update spectrogram.py](https://github.com/sunpy/sunpy/pull/2034)|Enhancement, updating class formats|Closed|
|[Update test_time.py ](https://github.com/sunpy/sunpy/pull/2030)| Enhancement tests| Closed|
|[Update time.py Removed extract_time](https://github.com/sunpy/sunpy/pull/2029)|[Remove extract_time function](https://github.com/sunpy/sunpy/issues/2024)|Merged|
|[Update rescale.py](https://github.com/sunpy/sunpy/pull/2022)|[reshape_image_to_4d_superpixel array seems broken](https://github.com/sunpy/sunpy/issues/2020)|Merged|
|[Updated tests for resampling Generic Map and some documentation in the Sunpy/data/test](https://github.com/sunpy/sunpy/pull/2011) and [Update dimensions metadata](https://github.com/sunpy/sunpy/pull/2010) |[Update dimensions metadata when resampling a map](https://github.com/sunpy/sunpy/issues/1870)|Closed|
|[show_colormaps() should check how much display is available Update cm.py ](https://github.com/sunpy/sunpy/pull/1980)|Enhancement on improving colormaps display| Closed|
|[net.vso.attrs broken in RST fixed](https://github.com/sunpy/sunpy/pull/2300)|[Some docstrings for net.vso.attrs are not showing up correctly on RTD](https://github.com/sunpy/sunpy/issues/2299)| Closed|


Contribution to SunPy Website

| Pull Requests |  Corresponding Issue | Status |
|:-------------:|:-------------:|:-------------:|
|[help section Docs link updated](https://github.com/sunpy/sunpy.github.io/pull/92)|[Sunpy Documentation Link Showing Privacy Error](https://github.com/sunpy/sunpy.github.io/issues/91)| Merged |
|[Sunpy Presentations and Talks Upload on the Site](https://github.com/sunpy/sunpy.github.io/pull/90)|Enhancement|Merged|
|[Registry of Sunpy Affiliated Packages](https://github.com/sunpy/sunpy.github.io/pull/89)|Enhancement -Introducing Affiliated Packages Registry |Merged|
|[Author attributes update](https://github.com/sunpy/sunpy.github.io/pull/77) and [Author names link to github under blog posts](https://github.com/sunpy/sunpy.github.io/pull/74)|Enhancement for Blogging System|Closed|
|[Update bootstrap.css bootstrap version updated](https://github.com/sunpy/sunpy.github.io/pull/72)|[Update bootstrap](https://github.com/sunpy/sunpy.github.io/issues/39)|Merged|
|[Update about.html Community Link updated to matrix](https://github.com/sunpy/sunpy.github.io/pull/71)|Enhancement| Merged|
|[Update contribute.html link updated to matrix channel](https://github.com/sunpy/sunpy.github.io/pull/68)|Enhancement|Merged|
|[Update help.html Link updated to matrix ](https://github.com/sunpy/sunpy.github.io/pull/65)|Enhancement|Merged|


| Issues Opened
|:--------------:|
| [reshape_image_to_4d_superpixel array seems broken : #2020](https://github.com/sunpy/sunpy/issues/2020)
| [AttributeError for BufferedIOBase while running python setup.py build_docs -o : #2031](https://github.com/sunpy/sunpy/issues/2031)
|[Spectrogram Attributes not Documented Well #2033](https://github.com/sunpy/sunpy/issues/2033)
| [README badges broken #2053](https://github.com/sunpy/sunpy/issues/2053)
|[ Code not showing up in maps.rst for plotting keywords and colormap section #2046](https://github.com/sunpy/sunpy/issues/2046)
|[Possible Bug in MapcubeAnimator updatefig method](https://github.com/sunpy/sunpy/issues/2444)

------------

### Project : Transition to Astropy Time

### Abstract

#### Mentors : @Cadair, @Nabobalis, @Punyaslok


As a research organisation, SunPy involves working with scientific data and hence precision is really fundamental for analysis of those data.

Majority of SunPy uses the `datetime.datetime` object as its representation of time.
However using only `datetime.datetime` has demerits including less precision as opposed to `astropy.time` which supports much higher precision representations of time such as leap seconds. `astropy.time` also supports time formats e.g. TAI time which can not be done using `datetime.datetime`. Hence switching to `astropy.time` is required in order to support such additional features.

The project will involve two parts.

Firstly,  majority of the SunPy library using `datetime` should be modified to use `astropy.Time`.
Secondly, the `parse_time` function residing under the `sunpy.time` module is used by majority of the modules under `sunpy.net`. The function parses a time string and returns a `datetime` object. It therefore needs redesigning in order to return `astropy.Time` object.


The SunPy `net` module involves a lot of work using the `sunpy.time.parse_time` function among other modules under sunpy. Hence transition to `astropy.time` will not only involve redesign to `astropy.time.Time` but also update to the modules under sunpy.net using `sunpy.time.parse_time`.



### Milestones

* Transition of every part of the SunPy code base to `astropy.Time` instead of using `datetime.datetime` for representation of time.

* Redesigning of the `sunpy.time.parse_time` to return `astropy.Time` object upon parsing any time like inputs. Also in addition the function should have a better API design as opposed to the present situation.

* Updating the modules under `sunpy.net` to use the modified version of `parse_time`.

* Including tests for the newly designed `parse_time` along with proper documentation. Also some of the documentation needs to be updated or created wherever any SunPy module will be using `astropy.Time` instead of `datetime`.



------------------------------------------


### Detailed Description

#### Switching to Astropy.Time from Datetime

A major part of this project involves switching to `astropy.Time` for the modules currently using `datetime` object.

This will involve updating the current functions which involves working on `datetime` objects and switch them to use
`astropy.Time` objects. Apart from this, it will also involve modifying changes to operations performed upon `datetime` objects
which might become invalid upon operating on `astropy.Time` objects.

For example there are many instances of the function `datetime.strftime`. Hence modification needs to be done to use the corresponding sub-function under `astropy.Time`.

Secondly, tests involving functions operating on `datetime` objects needs to be changed and new tests need to be written down for modules working with
`astropy.Time` object.

Also documentation for all such modules under the sunpy codebase needs to be updated to support `astropy.Time`.


#### Redesign of `sunpy.time.parse_time` function

Currently most of the time related operations under SunPy is based on `sunpy.time.parse_time` function. Most modules under
`sunpy.net` like `vso` , `jsoc` and `helio` use `sunpy.time.parse_time`.

###### A quick comparison between **datetime.datetime** and **astropy.time.Time**

| Features | `datetime.datetime` |  `astropy.time.Time` |
| ------------- |:-------------:|:-----------------:|
| Time formats              |   It includes limited time formats. [Time format links](https://github.com/sunpy/sunpy/blob/24ac587c8754ee2fd86c1164c16dc45e7affb02d/sunpy/time/time.py#L27). It does not support time formats like Barycentric Dynamical Time(TDB), International Atomic Time(TAI) among others.| `astropy.time.Time` includes different types of time formats like TAI,TDB,TCB and TCB among others. [Time format links](https://github.com/astropy/astropy/blob/ad1b26915adbb1c360ae88eb4c2a7b0c17e577bd/astropy/time/core.py#L36)  [Issue #2155](https://github.com/sunpy/sunpy/issues/2155)|
| Level of Precision              |  It ignores leap seconds since datetime can not handle leap seconds.             | It can handle leap seconds.    [Issue Link 993](https://github.com/sunpy/sunpy/issues/993). A good thing about `astropy.time` is that it supports setting the precision from the user side|
| Support for Location                |     The current module doesn't support for passing any location frame (an EarthLocation instance)`astropy.coordinates.EarthLocation` | Supports location as user input to the `astropy.Time` class. [Code Link](https://github.com/astropy/astropy/blob/ad1b26915adbb1c360ae88eb4c2a7b0c17e577bd/astropy/time/core.py#L216)

The main change that will involve is to make the `sunpy.time.parse_time` return `astropy.Time`object instead of returning `datetime` objects as of now.
Secondly, the `sunpy.time.parse_time` needs to have a more robust API along with additional features supported by `astropy.Time`. Hence redesigning `sunpy.time.parse_time` function will help the current function to evolve itself into a good API with more features.


### Proposed Solution

There are many shortcomings in `parse_time` function as discussed above which we shall overcome as part of this GSOC project. The following shows a point wise demerit of `parse_time` and its possible solution using `astropy.time.Time`

*  **Working on time strings and setting the format**
   - `parse_time` does not support any provision for different time formats like `iso`, `isot` and `fits` to name a few.
      The following code throws an error while parsing time string of `utc` format in `parse_time`.

      ```
       from sunpy.time import parse_time
       parse_time('2011-01-01T00:10:00.000(UTC)')

      ```

       while we can easily do so in case of `astropy.time.Time`
       ```
       import astropy.time as tm

       x = tm.Time('2011-01-01T00:10:00.000(UTC)')
       ```

       So one possible solution is to check if the given time string is of the above type. If the time string is of the
       above format '2011-01-01T00:10:00.000(UTC)' then we can define a new function , say `diff_format()`to take such
       string as input and return `astropy.time.Time` instance. Later we can make a check if the input string is of the
       above format, then we can just call the `diff_format()` function within the `parse_time`.
      ```
        def parse_time(time_string):

          if(time_string_format is not valid):
             call diff_format

        def diff_format(time_string) :
            return r.Time(time_string)
        ```

  -  **Setting format**

        `astropy.time.Time` has provision for setting the format from the user side. Like if the given time string is in `fits`, the user can also set the time string to own's format choice like `iso`
        ```
         import astropy.time as tm

         x = tm.Time('2011-01-01T00:10:00.000(UTC)')
         //  Its in `fits` format

        x.format = 'iso' // Converting to time format `iso`
        ```

        One solution can be done as follows.
        Within the `parse_time` function we can make provision for allowing the user to set the format by calling the corresponding `Time.format` function on the input string and setting it to the user input format.

- **Setting the Scale**
If the input time string is in `utc` format,    `astropy.time.Time` can set it to other formats like `tai`,    `tdb` and other.
```
   x = tm.Time('2011-01-01T00:10:00.000(UTC)')
   // its in `utc` format.

   x.set_scale('tai')  // setting it to TAI formats
```

  For providing such functionality in `parse_time` we can take user input for the scale and accordingly call the `set_scale` under `astropy.time` from within the `parse_time` to set the scale.


In the end the new tests need to be written down for the newly designed `sunpy.time.parse_time` function since the function will now support `astropy.Time` functionalities
and will return `astropy.Time` object as input.

Since most of the modules under `sunpy.net` uses `parse_time`, the function call and the methods of operating on the object return by the `parse_time` function needs to be
modified. Lastly suitable tests for each such module will have to be written down and replace the existing tests.

Documentation for the parse_time function needs to be written along with suitable examples depicting the `parse_time` returning `astropy.Time` objects.
Similarly documentation for the modules under `sunpy.net` using `parse_time` needs to be updated.



### Timeline

| Time Period |  My Work Plan  |
|:-------------:|:-------------:|
|May 14 - Jun 11| <li> **First Week** -- Dedicate this time to knowing more about the project, work with mentors and discuss with them the desired changes to `parse_time`. I would share my proposed design for returning `astropy.Time` object and upon consent will start implementing the basic functionality. This period would also be dedicated to knowing about the API changes required in `parse_time` and the design for adding extra functionalities of `astropy.Time` like seting scale and format under the functon.</li>  <li>**Second Week** -- Start working on refactoring the `parse_time` function to return `astropy.Time` object.  Also dedicate this time to work on adding features like Time formats for TAI, TDB and others.</li>   <li>**Third Week and Fourth Week**  Work on precision implementation in the current function with guidance to `astropy.time.Time.precision`. Write a function under the `parse_time`class that can set the precision of time by calling `astropy.Time._set_precision`.</li>
|Jun 11 -Jun15|  **Phase 1 Evaluation** - Have the modified version of `parse_time` ready. Should address to any prevalent bugs that may occur due to involvement of new functions. Once its set up , I plan to start working on the tests for the newly designed function. Apart from this, I will try to complete as much as documentation possible. |
|Jun 15 - Jul 9| <li> **First Week** Start working on updating the modules under `sunpy.net` for transition to use `astropy.Time`. This will involve modifying the functions currently taking input as `datetime` to updating them to use `astropy.Time` object. Also the inside body of such function needs to be changed in order to support `astropy.Time` objects.</li> <li> **Second Week**  During this time I plan to work on implementing the tests for all such modules where the transition is required.</li> <li> **Third Week** Dedicate this time to working on documentation for the modules where transition is required. </li> <li>**Fourth Week** During this time , I plan to work on updating the examples. Since the current examples work on datetime objects, they need to be updated to use `astropy.Time`.</li>
|Jul 9 - Jul 13|**Phase 2 Evaluation**  Remaining time will be dedicated to check for any bugs or breaks in the code where the transitions are made.  Cover up any remaining related issues during this time.|
|Jul 13 - August 6 | <li>**First Week** During this time, I plan to replace all usage of previous `parse_time` function with the newly designed one. This will require changes to most of the `sunpy.net` modules like `helio`, `vso`. Much of the code in each of these modules will need to be modified a bit in order to tune in to the newly designed function.</li> <li>**Second Week** Work on increasing test coverage wherever its required.</li> <li>**Third Week** Provide a more detailed documentation for the modules using `parse_time` along with support examples for the user to correlate to.|
|August 6 - 14|**Final Week** - See to if there exist any bugs that was not addressable before. Any pending work or issues will be addressed to during this time|






